<!DOCTYPE html>
<html lang="en" dir="ltr"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:w="tag:fullstack.wiki,2018:ns/"
	xmlns:xht="http://www.w3.org/1999/xhtml/vocab#"
>
	<head>
		<meta charset="UTF-8" />
		<title>ETag</title>
		<meta name="description" content="The ETag HTTP header provides an identifier that uniquely identifies the version and representation of the resource." />
		<link rel="up" href="index.xml" />
	</head>
	<body>
		<main about="tag:fullstack.wiki,2018:ns/http/headers/ETag" typeof="w:HTTP-Header">
			<a rel="http://www.w3.org/1999/xhtml/vocab#describedby" href="" />

			<h1>ETag</h1>
			<p>The "ETag" header field provides an identifier that uniquely identifies the selected representation, typically used for caching and conditional requests. It is used to distinguish between different representations of the resource that may be selected and the changes to those resources over time.</p>
			<p>This entity-tag is used for making subsequent requests in the <a href="If-Match.xml">If-Match</a> and <a href="If-None-Match.xml">If-None-Match</a> headers.</p>

			<h2>Writing responses (origin servers)</h2>

			<h3>200 (OK) responses</h3>
			<p>Use <code>ETag</code> whenever it is feasible to generate one; especially if the server expects to serve the same document to the client in the future. If clients implement ETag support and it is the case the document hasn't changed, the server can avoid re-sending the document contents in response to that request.</p>
			<p>The ETag is computed just after the server has determined which particular representation it will send to the client, but before it actually has to generate the payload. The purpose of the ETag is to avoid generating and sending a response if the client has a stored previous response; so the ETag must be a function of any variables that would cause the response payload to change. The metadata may change, so long as the payload does not(for example, two documents with different media types may share the same ETag if their contents are the same). Often, servers will compute an ETag by hashing the negotiated variant and last-modified values together. For documents on a filesystem, servers may hash a salt, filename, mtime (high-precision if available), and document size together. The document size is included so that data appended will also change the ETag, even if the mtime does not. For documents generated by a function, the ETag might be generated by hashing the function name and function parameters together, computed before calling the function.</p>
			<p>If the document would otherwise be unable to generate a strong ETag, it may instead choose to generate a weak ETag. Weak ETags are a <a href="https://httpwg.org/specs/rfc7232.html#weak.and.strong.validators">weak validator</a> allowed to change in insignificant ways while still matching. For example, differences is lossy compression, a different encoding of the same image, or real-time data that has not significantly changed (for some statistical definition of significant).</p>
			<p>Servers should send both <a href="Last-Modified.xml">Last-Modified</a> and ETag.</p>
			<p>Servers must include this header even in a <a href="../status-codes/304.xml">304 (Not Modified) response</a>.</p>
			<p>The ETag syntax has previously been defined as a quoted-string; so backslashes should be avoided, and should also be a valid quoted-string production if used.</p>

			<h3>201 (Created) responses</h3>
			<p>The ETag header in a 201 (Created) response refers to the ETag of the newly created resource. See <a href="../status-codes/201.xml">201 (Created)</a> for additional information.</p>

			<!-- TODO: section on transforming caches -->
			<!-- <h2>Forwarding responses (intermediaries)</h2> -->

			<h2>Reading responses (user agents)</h2>
			<p>User agents may use a response with an ETag to update the local cache. See <a href="If-None-Match.xml">If-None-Match</a> and the caching rules for more information.</p>

			<h2>Overview table</h2>
			<dl class="inline">
				<dt>Name</dt>
				<dd property="w:HTTP-Header-name">ETag</dd>
				<dt>Description</dt>
				<dd property="w:HTTP-Header-description">Specifies an identifier for the selected representation</dd>
				<dt>Direction</dt>
				<dd property="w:HTTP-Header-direction">Request</dd>
				<dt>Specification</dt>
				<dd property="w:specification"><a href="https://www.rfc-editor.org/rfc/rfc9110#name-etag">RFC 9110: HTTP Semantics &#xA7;8.8.3. ETag</a></dd>
			</dl>

			<h2>Syntax</h2>
			<pre type="abnf" w:space="indent">
				ETag       = entity-tag

				entity-tag = [ weak ] opaque-tag
				weak       = %x57.2F ; "W/", case-sensitive
				opaque-tag = DQUOTE *etagc DQUOTE
				etagc      = %x21 / %x23-7E / obs-text
							  ; VCHAR except double quotes, plus obs-text
			</pre>

			<h2>Matching</h2>
			<p>ETags can be matched with one of two algorithms:</p>

			<h3>Strong comparison</h3>
			<p>With a strong comparison, the ETags must match, and neither can be a weak ETag.</p>

			<h3>Weak comparison</h3>
			<p>With a weak comparison, the ETags merely need to match, and the weak-tag, if any, is ignored.</p>

			<h2>History</h2>
			<ol>
				<li>1999-06: <a href="https://www.rfc-editor.org/rfc/rfc2616.html#section-14.19">RFC 2616 &#xA7;14.19. ETag</a></li>
				<li>2014-06: <a href="https://httpwg.org/specs/rfc7232.html#header.etag">RFC 7232 &#xA7;2.3. ETag</a></li>
				<li>2022-06: <a href="https://www.rfc-editor.org/rfc/rfc9110#name-etag">RFC 9110 &#xA7;8.8.3. ETag</a></li>
			</ol>
		</main>
	</body>
</html>
